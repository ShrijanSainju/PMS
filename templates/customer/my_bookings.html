{% extends 'base.html' %}
{% load static %}

{% block title %}My Bookings - PMS{% endblock %}

{% block extra_css %}
<style>
    .bookings-container {
        padding: 2rem 0;
    }

    .booking-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .booking-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }

    .booking-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #f0f0f0;
    }

    .booking-id {
        font-size: 1.2rem;
        font-weight: 700;
        color: #2c3e50;
    }

    .status-badge {
        padding: 0.5rem 1rem;
        border-radius: 25px;
        font-size: 0.875rem;
        font-weight: 600;
        text-transform: uppercase;
    }

    .status-confirmed {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
    }

    .status-active {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        color: white;
    }

    .status-completed {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        color: white;
    }

    .status-cancelled, .status-expired {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        color: white;
    }

    .booking-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }

    .info-item {
        display: flex;
        flex-direction: column;
    }

    .info-label {
        font-size: 0.85rem;
        color: #6c757d;
        margin-bottom: 0.25rem;
    }

    .info-value {
        font-size: 1rem;
        font-weight: 600;
        color: #2c3e50;
    }

    .booking-actions {
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #f0f0f0;
        display: flex;
        gap: 0.5rem;
    }

    .section-header {
        background: linear-gradient(135deg, #20c997 0%, #17a2b8 100%);
        color: white;
        padding: 1.5rem;
        border-radius: 12px;
        margin-bottom: 1.5rem;
    }

    .empty-state {
        text-align: center;
        padding: 3rem;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .empty-state i {
        font-size: 4rem;
        color: #dee2e6;
        margin-bottom: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container bookings-container">
    <div class="section-header">
        <h1><i class="fas fa-calendar-alt"></i> My Bookings</h1>
        <p class="mb-0">Manage your parking reservations</p>
    </div>

    <div class="mb-4">
        <a href="{% url 'create_booking' %}" class="btn btn-primary btn-lg">
            <i class="fas fa-plus"></i> New Booking
        </a>
        <a href="{% url 'customer_dashboard' %}" class="btn btn-outline-secondary btn-lg ms-2">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <h3 class="text-primary">{{ upcoming_bookings.count }}</h3>
                    <p class="mb-0">Upcoming</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <h3 class="text-success">{{ active_bookings.count }}</h3>
                    <p class="mb-0">Active</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <h3 class="text-info">{{ total_bookings }}</h3>
                    <p class="mb-0">Total</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <h3 class="text-secondary">{{ past_bookings.count }}</h3>
                    <p class="mb-0">Completed</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Active Bookings -->
    {% if active_bookings %}
    <div class="mb-4">
        <h3><i class="fas fa-car"></i> Active Bookings</h3>
        {% for booking in active_bookings %}
        <div class="booking-card border-start border-4 border-primary">
            <div class="booking-header">
                <div class="booking-id">{{ booking.booking_id }}</div>
                <span class="status-badge status-{{ booking.status }}">{{ booking.get_status_display }}</span>
            </div>
            <div class="booking-info">
                <div class="info-item">
                    <span class="info-label">Vehicle</span>
                    <span class="info-value">{{ booking.vehicle.plate_number }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Parking Slot</span>
                    <span class="info-value">{{ booking.slot.slot_id }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Checked In</span>
                    <span class="info-value">{{ booking.actual_arrival|date:"M d, Y H:i" }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Estimated Fee</span>
                    <span class="info-value">₹{{ booking.estimated_fee|floatformat:0 }}</span>
                </div>
            </div>
            <div class="booking-actions">
                <a href="{% url 'booking_detail' booking.id %}" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-eye"></i> View Details
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Upcoming Bookings -->
    {% if upcoming_bookings %}
    <div class="mb-4">
        <h3><i class="fas fa-clock"></i> Upcoming Bookings</h3>
        {% for booking in upcoming_bookings %}
        <div class="booking-card border-start border-4 border-success">
            <div class="booking-header">
                <div class="booking-id">{{ booking.booking_id }}</div>
                <span class="status-badge status-{{ booking.status }}">{{ booking.get_status_display }}</span>
            </div>
            <div class="booking-info">
                <div class="info-item">
                    <span class="info-label">Vehicle</span>
                    <span class="info-value">{{ booking.vehicle.plate_number }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Parking Slot</span>
                    <span class="info-value">{{ booking.slot.slot_id }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Scheduled Arrival</span>
                    <span class="info-value">{{ booking.scheduled_arrival|date:"M d, Y H:i" }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Time Until Arrival</span>
                    <span class="info-value">{{ booking.time_until_arrival }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Expected Duration</span>
                    <span class="info-value">{{ booking.expected_duration }} min</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Estimated Fee</span>
                    <span class="info-value">₹{{ booking.estimated_fee|floatformat:0 }}</span>
                </div>
            </div>
            <div class="booking-actions">
                <a href="{% url 'booking_detail' booking.id %}" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-eye"></i> View Details
                </a>
                {% if booking.can_cancel %}
                <a href="{% url 'cancel_booking' booking.id %}" class="btn btn-sm btn-outline-danger">
                    <i class="fas fa-times"></i> Cancel
                </a>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Past Bookings -->
    {% if past_bookings %}
    <div class="mb-4">
        <h3><i class="fas fa-history"></i> Past Bookings</h3>
        {% for booking in past_bookings %}
        <div class="booking-card border-start border-4 border-secondary">
            <div class="booking-header">
                <div class="booking-id">{{ booking.booking_id }}</div>
                <span class="status-badge status-{{ booking.status }}">{{ booking.get_status_display }}</span>
            </div>
            <div class="booking-info">
                <div class="info-item">
                    <span class="info-label">Vehicle</span>
                    <span class="info-value">{{ booking.vehicle.plate_number }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Scheduled Arrival</span>
                    <span class="info-value">{{ booking.scheduled_arrival|date:"M d, Y H:i" }}</span>
                </div>
                {% if booking.parking_session %}
                <div class="info-item">
                    <span class="info-label">Final Fee</span>
                    <span class="info-value">₹{{ booking.parking_session.fee|floatformat:0|default:"N/A" }}</span>
                </div>
                {% endif %}
            </div>
            <div class="booking-actions">
                <a href="{% url 'booking_detail' booking.id %}" class="btn btn-sm btn-outline-secondary">
                    <i class="fas fa-eye"></i> View Details
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Empty State -->
    {% if not bookings %}
    <div class="empty-state">
        <i class="fas fa-calendar-times"></i>
        <h4>No Bookings Yet</h4>
        <p class="text-muted">Start by creating your first parking booking</p>
        <a href="{% url 'create_booking' %}" class="btn btn-primary btn-lg mt-3">
            <i class="fas fa-plus"></i> Create Booking
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
